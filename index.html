
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Gestione Esami</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: 20px auto; }
    input, select, button, textarea { margin: 5px 0; padding: 8px; width: 100%; }
    .materia-box { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
  </style>
</head>
<body>

  <h1>ðŸ“š Pianificazione Esami Universitari</h1>

  <label>Anno di corso:</label>
  <select id="anno">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="mag1">Magistrale 1</option>
    <option value="mag2">Magistrale 2</option>
  </select>

  <label>Tipo di UniversitÃ :</label>
  <input id="tipoUni" placeholder="Es. triennale, magistrale, ciclo unico">

  <h3>Materie</h3>
  <div id="materie"></div>
  <button onclick="aggiungiMateria()">+ Aggiungi materia</button>

  <hr>
  <button onclick="calcolaPiano()">ðŸ“… Calcola piano esami</button>

  <h2>ðŸ“Š Risultato:</h2>
  <div id="output"></div>

<script>
  let materieContainer = document.getElementById('materie');

  function aggiungiMateria() {
    const box = document.createElement('div');
    box.className = 'materia-box';
    box.innerHTML = `
      <label>Nome materia:</label>
      <input class="nome" placeholder="Es. Analisi 2">
      <label>CFU:</label>
      <input class="cfu" type="number">
      <label>DifficoltÃ  (1-5):</label>
      <input class="diff" type="number" min="1" max="5">
      <label>Appelli (separati da virgola, formato YYYY-MM-DD):</label>
      <input class="appelli" placeholder="2025-07-01,2025-07-20">
    `;
    materieContainer.appendChild(box);
  }

  function calcolaPiano() {
    const oggi = new Date();
    const materieHTML = document.querySelectorAll('.materia-box');
    let suggerimenti = [];

    materieHTML.forEach(box => {
      const nome = box.querySelector('.nome').value;
      const cfu = parseInt(box.querySelector('.cfu').value);
      const diff = parseInt(box.querySelector('.diff').value);
      const appelliStr = box.querySelector('.appelli').value;
      const appelli = appelliStr.split(',').map(a => new Date(a.trim()));
      const carico = cfu * diff;

      let bestScore = Infinity;
      let bestAppello = null;

      appelli.forEach(data => {
        const giorniDisponibili = (data - oggi) / (1000 * 60 * 60 * 24);
        if (giorniDisponibili > 0) {
          const score = carico / giorniDisponibili;
          if (score < bestScore) {
            bestScore = score;
            bestAppello = data;
          }
        }
      });

      if (bestAppello) {
        const inizioStudio = new Date(bestAppello);
        inizioStudio.setDate(inizioStudio.getDate() - Math.round(carico));
        suggerimenti.push({
          materia: nome,
          esame: bestAppello.toISOString().split('T')[0],
          inizio: inizioStudio.toISOString().split('T')[0],
          giorniStudio: Math.round(carico)
        });
      }
    });

    suggerimenti.sort((a, b) => a.esame.localeCompare(b.esame));

    const out = document.getElementById('output');
    out.innerHTML = '';
    suggerimenti.forEach(s => {
      out.innerHTML += `<p><strong>${s.materia}</strong>: esame il <b>${s.esame}</b> â†’ inizio studio consigliato il <b>${s.inizio}</b> (${s.giorniStudio} giorni)</p>`;
    });
  }
</script>

</body>
</html>
